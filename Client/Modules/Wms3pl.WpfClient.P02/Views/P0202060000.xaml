<?xml version="1.0" encoding="utf-8"?>
<uiLib:Wms3plUserControl x:Class="Wms3pl.WpfClient.P02.Views.P0202060000" xmlns:telerik="http://schemas.telerik.com/2008/xaml/presentation" xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation" xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" xmlns:d="http://schemas.microsoft.com/expression/blend/2008" mc:Ignorable="d" xmlns:uiLib="clr-namespace:Wms3pl.WpfClient.UILib;assembly=Wms3pl.WpfClient.UILib" xmlns:controls="clr-namespace:Wms3pl.WpfClient.UILib.Controls;assembly=Wms3pl.WpfClient.UILib" xmlns:common="clr-namespace:Wms3pl.WpfClient.Common;assembly=Wms3pl.WpfClient.Common" xmlns:converter="clr-namespace:Wms3pl.WpfClient.Common.Converters;assembly=Wms3pl.WpfClient.Common" xmlns:viewModel="clr-namespace:Wms3pl.WpfClient.P02.ViewModel" xmlns:Properties="clr-namespace:Wms3pl.WpfClient.P02.Properties" xmlns:res="clr-namespace:Wms3pl.WpfClient.Resources;assembly=Wms3pl.WpfClient.Resources" x:Name="Window" Margin="0,0,0,0" HorizontalAlignment="Stretch" FontSize="18" MinWidth="800" controls:PermissionService.FunctionId="P0202060000" controls:PermissionService.FunctionName="商品檢驗與容器綁定" FormException="{Binding Exception}" Loaded="Window_Loaded">
    <uiLib:Wms3plUserControl.DataContext>
        <viewModel:P0202060000_ViewModel x:Name="Vm" />
    </uiLib:Wms3plUserControl.DataContext>
    <uiLib:Wms3plUserControl.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="/Wms3pl.WpfClient.UILib;component/Generic.xaml" />
            </ResourceDictionary.MergedDictionaries>
            <common:NotConverter x:Key="NotConverter" />
            <converter:CheckStateConverter x:Key="CheckStateConverter" />
            <converter:StringToBoolConverter x:Key="StringToBoolConverter" />
            <converter:StringTypeToBoolConverter x:Key="StringTypeToBoolConverter" />
            <converter:TimeStringToTimeFormatConverter x:Key="TimeStringConverter" />
            <converter:MultiBoolNorConverter x:Key="MultiBoolNorConverter" />
            <converter:NameValuePairMultiConverter x:Key="NameValuePairMultiConverter" />
            <Style TargetType="CheckBox" x:Key="CheckStyle" BasedOn="{StaticResource {x:Type CheckBox}}">
                <Setter Property="VerticalAlignment" Value="Center" />
                <Setter Property="HorizontalAlignment" Value="Center" />
            </Style>
            <Style TargetType="DataGridCell" x:Key="NumberCellStyle">
                <Setter Property="HorizontalContentAlignment" Value="Right" />
            </Style>
            <converter:StringToVisiablityConverter x:Key="StringToVisiablityConverter" />
            <FrameworkElement x:Key="ProxyElement" DataContext="{Binding}" />
        </ResourceDictionary>
    </uiLib:Wms3plUserControl.Resources>
    <telerik:RadBusyIndicator x:Name="GridBusyIndicator" BusyContent="{x:Static res:Resources.Loading}" IsIndeterminate="False" IsBusy="{Binding IsBusy}">
        <uiLib:BasicMaster x:Name="Master">
            <uiLib:BasicMaster.ToolBarArea>
                <WrapPanel>

                    <Button Style="{StaticResource SearchButton}" controls:PermissionService.FunctionId="BP0202060001" Command="{Binding SearchCommand}" CommandParameter="true" />
                    <Button Style="{StaticResource EditButton}" controls:PermissionService.FunctionId="BP0202060002" Command="{Binding EditCommand}" />
                    <Button Style="{StaticResource CancelButton}" controls:PermissionService.FunctionId="BP0202060003" Command="{Binding CancelCommand}" />
                    <Button Style="{StaticResource SaveButton}" controls:PermissionService.FunctionId="BP0202060004" Command="{Binding SaveCommand}">
                        <Button.IsEnabled>
                            <MultiBinding Converter="{StaticResource MultiBoolNorConverter}">
                                <Binding ElementName="LayoutRoot" Path="(Validation.HasError)" />
                                <Binding ElementName="dgList" Path="HasError" />
                            </MultiBinding>
                        </Button.IsEnabled>
                    </Button>
                </WrapPanel>
            </uiLib:BasicMaster.ToolBarArea>
            <uiLib:BasicMaster.MainContent>
                <TabControl x:Name="LayoutRoot">
                    <TabControl.BindingGroup>
                        <BindingGroup Name="errorGroup" />
                    </TabControl.BindingGroup>
                    <TabItem Header="{x:Static res:Resources.Main}" Width="Auto">
                        <DockPanel>
                            <!-- 由此處開始加入畫面項目 -->
                            <DockPanel DockPanel.Dock="Top" Margin="5">
                            <WrapPanel>
                                <Label Content="{x:Static Properties:Resources.DC_CODE}" Style="{StaticResource LbStyle}" />
                                <ComboBox Style="{StaticResource ComboStyle}" SelectedIndex="0" IsEnabled="{Binding DcEnabled, UpdateSourceTrigger=PropertyChanged}" ItemsSource="{Binding DcList, UpdateSourceTrigger=PropertyChanged}" DisplayMemberPath="Name" SelectedValuePath="Value" SelectedValue="{Binding SelectedDc, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                                <Label Content="{x:Static Properties:Resources.SelectedDt}" Style="{StaticResource LbStyle}" />
                                <DatePicker IsEnabled="False" SelectedDate="{Binding SelectedDt, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, ValidatesOnExceptions=true, NotifyOnValidationError=true, ValidatesOnDataErrors=True}" Style="{StaticResource DateStyle}" />
                                <Label Content="{x:Static Properties:Resources.P0202030000_PURCHASE_NO}" Style="{StaticResource LbStyle}" />
                                <TextBox Name="txtPurchaseNo" Width="170" MaxLength="25" Text="{Binding SelectedPurchaseNo, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, ValidatesOnExceptions=true, NotifyOnValidationError=true, ValidatesOnDataErrors=True}" Style="{StaticResource TxtStyle}" KeyDown="txtPurchaseNo_KeyDown" />
                                <CheckBox Style="{StaticResource CheckStyle}" IsChecked="{Binding IsPickLocFirst,Mode=TwoWay,UpdateSourceTrigger=PropertyChanged}" Content="{x:Static Properties:Resources.IsPickLocFirst}" VerticalContentAlignment="Center" />
                                <Label Content="{Binding FastPassTypeName,Mode=TwoWay,UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource LbStyle}" FontSize="40" FontWeight="Bold" Foreground="{Binding FastPassTypeColor,Mode=TwoWay,UpdateSourceTrigger=PropertyChanged}" />
                            </WrapPanel>
                                <WrapPanel DockPanel.Dock="Right" HorizontalAlignment="Right">
                                    <Button Name="btnContainerDetail" Content="容器明細" Style="{StaticResource BtnStyle}" Command="{Binding ContainerDetailCommand}" controls:PermissionService.FunctionId="BP0202060005" controls:PermissionService.FunctionName="容器明細" Click="ContainerDetail_OnClick"/>
                                    <Button Content="重新取得LMS上架倉別指示" Command="{Binding RegetLmsApiStowShelfAreaGuideCommand}" Style="{StaticResource BtnStyle}"/>
                                </WrapPanel>

                            </DockPanel>
                            <GroupBox Header="{Binding GroupHeader, UpdateSourceTrigger=PropertyChanged}">
                                <DockPanel>
                                    <WrapPanel DockPanel.Dock="Top" Margin="5">
                                        <Button Name="btnItemVerify" Content="{x:Static Properties:Resources.VerifyItem}" Style="{StaticResource BtnStyle}" controls:PermissionService.FunctionId="BP0202060006" controls:PermissionService.FunctionName="商品檢驗" Click="VerifyItem_OnClick" IsEnabled="{Binding ItemVerifyEnabled, UpdateSourceTrigger=PropertyChanged}" />
                                        <Button Name="btnReadSerialNo" Content="{x:Static Properties:Resources.ReadSerial}" Style="{StaticResource BtnStyle}" controls:PermissionService.FunctionId="BP0202060007" controls:PermissionService.FunctionName="序號刷讀" Click="ReadSerial_OnClick" IsEnabled="{Binding ReadSerialNoEnabled, UpdateSourceTrigger=PropertyChanged}" />
                                        <Button Name="btnAcceptance" Content="{x:Static Properties:Resources.Accpetance}" Style="{StaticResource BtnStyle}" Command="{Binding AccpetanceCommand}" CommandParameter="false" controls:PermissionService.FunctionId="BP0202060008" controls:PermissionService.FunctionName="驗收確認" />
                                        <Button Name="btnBindContainer" Content="綁容器" Style="{StaticResource BtnStyle}" Command="{Binding BindContainerCommand}" controls:PermissionService.FunctionId="BP0202060009" controls:PermissionService.FunctionName="綁容器" />
                                        <Button Name="btnCollectSerialNo" Content="{x:Static Properties:Resources.CollectSerial}" Style="{StaticResource BtnStyle}" controls:PermissionService.FunctionId="BP0202060010" controls:PermissionService.FunctionName="序號收集" Click="CollectSerial_OnClick" IsEnabled="{Binding CollectSerialNoEnabled, UpdateSourceTrigger=PropertyChanged}" />
                                        <Button Name="btnOutOfStock" Content="{x:Static Properties:Resources.OutOfStock}" Style="{StaticResource BtnStyle}" controls:PermissionService.FunctionId="BP0202060011" controls:PermissionService.FunctionName="缺貨確認" Command="{Binding OutOfStockCommand}" Visibility="{Binding OutOfStockVisiblity,Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                                        <Button Name="btnCancelAcceptance" Content="{x:Static Properties:Resources.CancelAcceptance}" Style="{StaticResource BtnStyle}" controls:PermissionService.FunctionId="BP0202060012" controls:PermissionService.FunctionName="取消驗收" Command="{Binding CancelAcceptanceCommand}" />
                                        <!--<Button Name="btnQuickCheck" Content="{x:Static Properties:Resources.QuickCheck}" Style="{StaticResource BtnStyle}" controls:PermissionService.FunctionId="BP0202060013" Command="{Binding QuickCheckCommand}"/>-->
                                        <Button Name="btnSetDefectQty" Content="{x:Static Properties:Resources.SetDefectQty}" Style="{StaticResource BtnStyle}" controls:PermissionService.FunctionId="BP0202060014"  controls:PermissionService.FunctionName="設定不良品數量" Click="SetDefectQty_OnClick" IsEnabled="{Binding ItemVerifyEnabled,UpdateSourceTrigger=PropertyChanged}"/>
                                        <StackPanel VerticalAlignment="Center">
                                            <TextBlock Text="{x:Static Properties:Resources.P0202030000_PrintDescription1}" TextWrapping="Wrap" FontSize="18" Foreground="Blue" FontWeight="Bold"/>
                                            <TextBlock Text="{x:Static Properties:Resources.P0202030000_PrintDescription2}" TextWrapping="Wrap" FontSize="18" Foreground="Blue" FontWeight="Bold"/>
                                        </StackPanel >
                                    </WrapPanel>
                                    <controls:ValidationDataGrid Name="dgList" ItemsSource="{Binding DgList, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource DgStyle}" SelectionMode="Single" SelectionUnit="FullRow" CellStyle="{StaticResource UcSingleRowEdit}" IsReadOnly="False" SelectedItem="{Binding SelectedData, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" VerticalContentAlignment="Center">
                                        <DataGrid.Columns>
                                            <DataGridTextColumn Header="{x:Static Properties:Resources.ITEM_CODE}" Binding="{Binding ITEM_CODE}" IsReadOnly="True" />
                                            <DataGridTextColumn Header="{x:Static Properties:Resources.ITEM_NAME}" Binding="{Binding ITEM_NAME}" IsReadOnly="True" />
                                            <DataGridTextColumn Header="{x:Static Properties:Resources.P020203_ORDER_QTY}" Binding="{Binding ORDER_QTY}" IsReadOnly="True" />
                                            <!-- 已驗收數: BY進倉單跟ITEM的F020201.RECV_QTY 加總 -->
                                            <DataGridTextColumn Header="{x:Static Properties:Resources.SUM_RECV_QTY}" Binding="{Binding SUM_RECV_QTY}" IsReadOnly="True" />
                                            <!-- 驗收總量: F02020101.RECV_QTY (第一次Insert帶F010202剩餘可驗收數F010202.STOCK_QTY-F020201.RECV_QTY) -->
                                            <DataGridTextColumn Header="{x:Static Properties:Resources.RECV_QTY}" Binding="{Binding RECV_QTY, ValidatesOnExceptions=True, NotifyOnValidationError=True, ValidatesOnDataErrors=True, UpdateSourceTrigger=PropertyChanged}" IsReadOnly="True" />
                                            <!--不良品數-->
                                            <DataGridTextColumn Header="{x:Static Properties:Resources.DEFECT_QTY}" Binding="{Binding DEFECT_QTY, ValidatesOnExceptions=True, NotifyOnValidationError=True, ValidatesOnDataErrors=True, UpdateSourceTrigger=PropertyChanged}" IsReadOnly="True" />
                                            <!-- 抽驗數: F02020101.CHECK_QTY =>驗收總量*抽驗比例 -->
                                            <DataGridTextColumn Header="{x:Static Properties:Resources.CHECK_QTY}" Binding="{Binding CHECK_QTY}" IsReadOnly="True" />
                                            <!--效期-->
                                            <DataGridTextColumn Header="{x:Static Properties:Resources.VALI_DATE}" Binding="{Binding VALI_DATE,StringFormat={}\{0:yyyy/MM/dd\}}" IsReadOnly="True" />
                                            <!-- 已檢驗 -> F02020101.CHECK_ITEM -->
                                            <DataGridTemplateColumn Header="{x:Static Properties:Resources.CHECK_ITEM}" IsReadOnly="True">
                                                <DataGridTemplateColumn.CellTemplate>
                                                    <DataTemplate>
                                                        <CheckBox IsEnabled="False" IsChecked="{Binding CHECK_ITEM, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged,Converter={StaticResource StringToBoolConverter}}" Style="{StaticResource CheckStyle}" />
                                                    </DataTemplate>
                                                </DataGridTemplateColumn.CellTemplate>
                                            </DataGridTemplateColumn>
                                            <!--批號-->
                                            <DataGridTextColumn Header="{x:Static Properties:Resources.MAKE_NO}" Binding="{Binding MAKE_NO}" IsReadOnly="True" />
                                            <!--包裝參考-->
                                            <DataGridTextColumn Header="{x:Static Properties:Resources.UNIT_TRANS}" Binding="{Binding UNIT_TRANS}" Visibility="{Binding DataContext.ShowUnitTrans,Source={StaticResource ProxyElement},Mode=TwoWay,UpdateSourceTrigger=PropertyChanged,Converter={StaticResource StringToVisiablityConverter}}" IsReadOnly="True" />
                                            <!--上架倉別-->
                                            <DataGridTextColumn Header="{x:Static Properties:Resources.TarwarehouseType}" IsReadOnly="True">
                                                <DataGridTextColumn.Binding>
                                                    <MultiBinding Converter="{StaticResource NameValuePairMultiConverter}">
                                                        <Binding Path="TARWAREHOUSE_ID" />
                                                        <Binding Path="DataContext.WarehouseList" RelativeSource="{RelativeSource AncestorType={x:Type uiLib:Wms3plUserControl}}" />
                                                    </MultiBinding>
                                                </DataGridTextColumn.Binding>
                                            </DataGridTextColumn>

                                            <!--商品序號-->
                                            <DataGridTemplateColumn Header="{x:Static Properties:Resources.BUNDLE_SERIALNO}" IsReadOnly="True">
                                                <DataGridTemplateColumn.CellTemplate>
                                                    <DataTemplate>
                                                        <CheckBox IsEnabled="False" IsChecked="{Binding BUNDLE_SERIALNO, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged,Converter={StaticResource StringToBoolConverter}}" Style="{StaticResource CheckStyle}" />
                                                    </DataTemplate>
                                                </DataGridTemplateColumn.CellTemplate>
                                            </DataGridTemplateColumn>
                                            <!-- 已刷讀序號 -> F02020101.CHECK_SERIAL -->
                                            <DataGridTemplateColumn Header="{x:Static Properties:Resources.CHECK_SERIAL}" IsReadOnly="True">
                                                <DataGridTemplateColumn.CellTemplate>
                                                    <DataTemplate>
                                                        <CheckBox IsEnabled="False" IsChecked="{Binding CHECK_SERIAL, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged,Converter={StaticResource StringToBoolConverter}}" Style="{StaticResource CheckStyle}" />
                                                    </DataTemplate>
                                                </DataGridTemplateColumn.CellTemplate>
                                            </DataGridTemplateColumn>
                                            <!-- 已列印 -> F02020101.ISPRINT -->
                                            <DataGridTemplateColumn Header="{x:Static Properties:Resources.ISPRINT}" IsReadOnly="True">
                                                <DataGridTemplateColumn.CellTemplate>
                                                    <DataTemplate>
                                                        <CheckBox IsEnabled="False" IsChecked="{Binding Path=ISPRINT, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged,Converter={StaticResource StringToBoolConverter}}" Style="{StaticResource CheckStyle}" />
                                                    </DataTemplate>
                                                </DataGridTemplateColumn.CellTemplate>
                                            </DataGridTemplateColumn>
                                            <!-- 已上傳圖檔 -> F02020101.ISUPLOAD -->
                                            <DataGridTemplateColumn Header="{x:Static Properties:Resources.ISUPLOAD}" IsReadOnly="True">
                                                <DataGridTemplateColumn.CellTemplate>
                                                    <DataTemplate>
                                                        <CheckBox IsEnabled="False" IsChecked="{Binding ISUPLOAD, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged,Converter={StaticResource StringToBoolConverter}}" Style="{StaticResource CheckStyle}" />
                                                    </DataTemplate>
                                                </DataGridTemplateColumn.CellTemplate>
                                            </DataGridTemplateColumn>
                                            <!--驗收狀態-->
                                            <DataGridTemplateColumn Header="{x:Static Properties:Resources.STATUS}" IsReadOnly="True">
                                                <DataGridTemplateColumn.CellTemplate>
                                                    <DataTemplate>
                                                        <ComboBox Style="{StaticResource ComboStyle}" ItemsSource="{Binding DataContext.StatusList, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type uiLib:Wms3plUserControl}}, UpdateSourceTrigger=PropertyChanged}" DisplayMemberPath="Name" SelectedValuePath="Value" IsEnabled="False" SelectedValue="{Binding STATUS}"></ComboBox>
                                                    </DataTemplate>
                                                </DataGridTemplateColumn.CellTemplate>
                                            </DataGridTemplateColumn>
                                            <!--進倉單號-->
                                            <DataGridTextColumn Header="{x:Static Properties:Resources.PURCHASE_NO}" Binding="{Binding PURCHASE_NO}" IsReadOnly="True" />
                                            <DataGridTextColumn Header="{x:Static Properties:Resources.PURCHASE_SEQ}" Binding="{Binding PURCHASE_SEQ}" IsReadOnly="True" />
                                        </DataGrid.Columns>
                                    </controls:ValidationDataGrid>
                                </DockPanel>
                            </GroupBox>
                        </DockPanel>
                    </TabItem>
                </TabControl>
            </uiLib:BasicMaster.MainContent>
        </uiLib:BasicMaster>
    </telerik:RadBusyIndicator>
</uiLib:Wms3plUserControl>